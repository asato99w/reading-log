# 第13章：Flyweight（構造パターン）

## 章の概要
内在状態と外在状態を分離することで、大量の細粒度オブジェクトを効率的に共有してサポートします。

## 主な内容

### 意図と構造
- 共通状態を共有することで大量のオブジェクトを効率的にサポート
- 多くの類似オブジェクトを扱う際のメモリ使用量を最小化
- 内在状態（共有可能）と外在状態（コンテキスト依存）を分離
- 必要時に外在状態で設定された共有flyweightオブジェクトを使用

### パターン参加者
- **Flyweight**：flyweightが外在状態を受け取り作用できるインターフェース
- **ConcreteFlyweight**：Flyweightを実装し内在状態を保存、共有可能でなければならない
- **UnsharedConcreteFlyweight**：すべてのflyweightサブクラスが共有される必要はない
- **FlyweightFactory**：flyweightオブジェクトを作成・管理、flyweightが適切に共有されることを保証
- **Context**：flyweightへの参照を維持し外在状態を保存

### 実装上の考慮事項
- Flyweightはコンテキストによって変化する外在状態を保存してはならない
- 外在状態は必要時にflyweight操作にパラメータとして渡される
- ファクトリがflyweightの共有を保証しflyweightプールを管理
- クライアントは外在状態の維持とflyweight操作への渡しに責任を持つ

## 重要ポイント
- **メモリ効率**：Flyweightは多くの類似オブジェクトが必要な場合にメモリ使用量を劇的に削減
- **状態分離**：内在（共有）状態と外在（コンテキスト依存）状態の明確な分離により効率的共有を可能
- **拡張性**：パターンによりアプリケーションが通常は法外なメモリを消費する非常に大量のオブジェクトをサポート可能